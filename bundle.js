(()=>{var w=class{constructor(){this.frozen=Array.from({length:9},()=>Array(9).fill(!1)),this.candidates=Array.from({length:9},()=>Array.from({length:9},()=>new Set([1,2,3,4,5,6,7,8,9])))}getCandidates(n,t){return this.candidates[n][t]}setCandidates(n,t,e){this.frozen[n][t]||(this.candidates[n][t]=new Set(e))}addCandidate(n,t,e){this.frozen[n][t]||this.candidates[n][t].add(e)}removeCandidate(n,t,e){this.frozen[n][t]||this.candidates[n][t].delete(e)}getBoard(){return this.candidates.map(n=>n.map(t=>t.size===1?Array.from(t)[0]:0))}isFrozen(n,t){return this.frozen[n][t]}setFrozen(n,t,e=!0){this.frozen[n][t]=e}reset(){this.frozen=Array.from({length:9},()=>Array(9).fill(!1)),this.candidates=Array.from({length:9},()=>Array.from({length:9},()=>new Set([1,2,3,4,5,6,7,8,9])))}};var m=class{constructor(n){this.board=null,this.activeCell=null,this.element=n,window.addEventListener("keydown",this.handleKeyDown.bind(this)),this.element.addEventListener("click",this.handleCellClick.bind(this))}setBoard(n){this.board=n,this.render()}setActiveCell(n,t){var e;!((e=this.board)===null||e===void 0)&&e.isFrozen(n,t)||(this.activeCell={row:n,col:t},this.render())}handleCellClick(n){let e=n.target.closest(".sudoku-cell");if(!e)return;let r=e.dataset.row?parseInt(e.dataset.row,10):NaN,s=e.dataset.col?parseInt(e.dataset.col,10):NaN;!isNaN(r)&&!isNaN(s)&&this.setActiveCell(r,s)}handleKeyDown(n){if(!this.activeCell||!this.board)return;let{row:t,col:e}=this.activeCell;this.board.isFrozen(t,e)||(n.key>="1"&&n.key<="9"?(this.board.setCandidates(t,e,[parseInt(n.key,10)]),this.render()):(n.key==="Backspace"||n.key==="Delete")&&(this.board.setCandidates(t,e,[1,2,3,4,5,6,7,8,9]),this.render()))}render(){if(this.element.innerHTML="",!!this.board)for(let n=0;n<9;n++)for(let t=0;t<9;t++){let e=document.createElement("div");e.classList.add("sudoku-cell"),e.dataset.row=n.toString(),e.dataset.col=t.toString(),this.board.isFrozen(n,t)&&e.classList.add("frozen"),this.activeCell&&this.activeCell.row===n&&this.activeCell.col===t&&e.classList.add("active");let r=this.board.getCandidates(n,t);if(r.size===1)e.textContent=Array.from(r)[0].toString(),e.classList.add("value-set");else{let s=document.createElement("div");s.classList.add("candidates-grid");for(let o=1;o<=9;o++){let i=document.createElement("span");i.textContent=r.has(o)?o.toString():"",s.appendChild(i)}e.appendChild(s)}this.element.appendChild(e)}}};var v=class{apply(n){for(let t=1;t<=9;t++){for(let e=0;e<9;e++){let r=[];for(let o=0;o<9;o++)n.isFrozen(e,o)||n.getCandidates(e,o).has(t)&&r.push(o);if(r.length<2)continue;let s=Math.floor(r[0]/3);if(r.every(o=>Math.floor(o/3)===s)){let o=Math.floor(e/3);for(let i=0;i<3;i++){let a=o*3+i;if(a!==e)for(let l=0;l<3;l++){let c=s*3+l;if(!n.isFrozen(a,c)&&n.getCandidates(a,c).has(t))return{changed:!0,removeCandidate:{row:a,col:c,value:t}}}}}}for(let e=0;e<9;e++){let r=[];for(let o=0;o<9;o++)n.isFrozen(o,e)||n.getCandidates(o,e).has(t)&&r.push(o);if(r.length<2)continue;let s=Math.floor(r[0]/3);if(r.every(o=>Math.floor(o/3)===s)){let o=Math.floor(e/3);for(let i=0;i<3;i++){let a=s*3+i;for(let l=0;l<3;l++){let c=o*3+l;if(c!==e&&!n.isFrozen(a,c)&&n.getCandidates(a,c).has(t))return{changed:!0,removeCandidate:{row:a,col:c,value:t}}}}}}}return{changed:!1}}},y=class{apply(n){for(let t=1;t<=9;t++)for(let e=0;e<3;e++)for(let r=0;r<3;r++){let s=[];for(let c=0;c<3;c++)for(let f=0;f<3;f++){let h=e*3+c,u=r*3+f;n.isFrozen(h,u)||n.getCandidates(h,u).has(t)&&s.push([h,u])}if(s.length<2)continue;let o=s.map(([c,f])=>c),i=s.map(([c,f])=>f),a=Array.from(new Set(o)),l=Array.from(new Set(i));if(a.length===1){let c=a[0];for(let f=0;f<9;f++)if(!(f>=r*3&&f<r*3+3)&&!n.isFrozen(c,f)&&n.getCandidates(c,f).has(t))return{changed:!0,removeCandidate:{row:c,col:f,value:t}}}if(l.length===1){let c=l[0];for(let f=0;f<9;f++)if(!(f>=e*3&&f<e*3+3)&&!n.isFrozen(f,c)&&n.getCandidates(f,c).has(t))return{changed:!0,removeCandidate:{row:f,col:c,value:t}}}}return{changed:!1}}},z=class{apply(n){function t(e){for(let r=0;r<e.length;r++){let[s,o]=e[r];if(n.isFrozen(s,o))continue;let i=Array.from(n.getCandidates(s,o));if(!(i.length<2||i.length>3))for(let a=r+1;a<e.length;a++){let[l,c]=e[a];if(n.isFrozen(l,c))continue;let f=Array.from(n.getCandidates(l,c));if(!(f.length<2||f.length>3))for(let h=a+1;h<e.length;h++){let[u,S]=e[h];if(n.isFrozen(u,S))continue;let E=Array.from(n.getCandidates(u,S));if(E.length<2||E.length>3)continue;let I=new Set([...i,...f,...E]);if(I.size===3)for(let[g,C]of e){if(n.isFrozen(g,C))continue;let L=n.getCandidates(g,C);if([...I].some(p=>L.has(p))&&!(g===s&&C===o||g===l&&C===c||g===u&&C===S)){for(let p of I)if(L.has(p))return{changed:!0,removeCandidate:{row:g,col:C,value:p}}}}}}}return{changed:!1}}for(let e=0;e<9;e++){let r=[];for(let o=0;o<9;o++)r.push([e,o]);let s=t(r);if(s.changed)return s}for(let e=0;e<9;e++){let r=[];for(let o=0;o<9;o++)r.push([o,e]);let s=t(r);if(s.changed)return s}for(let e=0;e<3;e++)for(let r=0;r<3;r++){let s=[];for(let i=0;i<3;i++)for(let a=0;a<3;a++)s.push([e*3+i,r*3+a]);let o=t(s);if(o.changed)return o}return{changed:!1}}},x=class{apply(n){function t(e){let r=[];for(let[s,o]of e){if(n.isFrozen(s,o))continue;let i=Array.from(n.getCandidates(s,o));if(i.length===2){let a=!1;for(let l of r)if(l.pair[0]===i[0]&&l.pair[1]===i[1]){l.positions.push([s,o]),a=!0;break}a||r.push({pair:i,positions:[[s,o]]})}}for(let s of r)if(s.positions.length===2)for(let[o,i]of e){if(s.positions.some(([l,c])=>l===o&&c===i))continue;let a=n.getCandidates(o,i);for(let l of s.pair)if(a.has(l))return{changed:!0,removeCandidate:{row:o,col:i,value:l}}}return{changed:!1}}for(let e=0;e<9;e++){let r=[];for(let o=0;o<9;o++)r.push([e,o]);let s=t(r);if(s.changed)return s}for(let e=0;e<9;e++){let r=[];for(let o=0;o<9;o++)r.push([o,e]);let s=t(r);if(s.changed)return s}for(let e=0;e<3;e++)for(let r=0;r<3;r++){let s=[];for(let i=0;i<3;i++)for(let a=0;a<3;a++)s.push([e*3+i,r*3+a]);let o=t(s);if(o.changed)return o}return{changed:!1}}},F=class{apply(n){for(let t=0;t<9;t++)for(let e=1;e<=9;e++){let r=0,s=-1;for(let o=0;o<9;o++)n.isFrozen(t,o)||n.getCandidates(t,o).has(e)&&(r++,s=o);if(r===1){let o=n.getCandidates(t,s);if(o.size>1){for(let i of Array.from(o))if(i!==e)return{changed:!0,removeCandidate:{row:t,col:s,value:i}}}}}for(let t=0;t<9;t++)for(let e=1;e<=9;e++){let r=0,s=-1;for(let o=0;o<9;o++)n.isFrozen(o,t)||n.getCandidates(o,t).has(e)&&(r++,s=o);if(r===1){let o=n.getCandidates(s,t);if(o.size>1){for(let i of Array.from(o))if(i!==e)return{changed:!0,removeCandidate:{row:s,col:t,value:i}}}}}for(let t=0;t<3;t++)for(let e=0;e<3;e++)for(let r=1;r<=9;r++){let s=0,o=[-1,-1];for(let i=0;i<3;i++)for(let a=0;a<3;a++){let l=t*3+i,c=e*3+a;n.isFrozen(l,c)||n.getCandidates(l,c).has(r)&&(s++,o=[l,c])}if(s===1){let[i,a]=o,l=n.getCandidates(i,a);if(l.size>1){for(let c of Array.from(l))if(c!==r)return{changed:!0,removeCandidate:{row:i,col:a,value:c}}}}}return{changed:!1}}},A=class{apply(n){for(let t=1;t<=9;t++){let e=[];for(let r=0;r<9;r++){let s=[];for(let o=0;o<9;o++)n.isFrozen(r,o)||n.getCandidates(r,o).has(t)&&s.push(o);s.length===2&&e.push([r,s])}for(let r=0;r<e.length;r++)for(let s=r+1;s<e.length;s++){let[o,i]=e[r],[a,l]=e[s];if(i[0]===l[0]&&i[1]===l[1]){for(let c of i)for(let f=0;f<9;f++)if(f!==o&&f!==a&&!n.isFrozen(f,c)&&n.getCandidates(f,c).has(t))return{changed:!0,removeCandidate:{row:f,col:c,value:t}}}}}for(let t=1;t<=9;t++){let e=[];for(let r=0;r<9;r++){let s=[];for(let o=0;o<9;o++)n.isFrozen(o,r)||n.getCandidates(o,r).has(t)&&s.push(o);s.length===2&&e.push([r,s])}for(let r=0;r<e.length;r++)for(let s=r+1;s<e.length;s++){let[o,i]=e[r],[a,l]=e[s];if(i[0]===l[0]&&i[1]===l[1]){for(let c of i)for(let f=0;f<9;f++)if(f!==o&&f!==a&&!n.isFrozen(c,f)&&n.getCandidates(c,f).has(t))return{changed:!0,removeCandidate:{row:c,col:f,value:t}}}}}return{changed:!1}}},k=class{apply(n){for(let t=0;t<9;t++)for(let e=0;e<9;e++){let r=n.getCandidates(t,e);if(r.size<=1||n.isFrozen(t,e))continue;for(let i=0;i<9;i++){if(i!==e){let a=n.getCandidates(t,i);if(a.size===1){let l=Array.from(a)[0];if(r.has(l))return{changed:!0,removeCandidate:{row:t,col:e,value:l}}}}if(i!==t){let a=n.getCandidates(i,e);if(a.size===1){let l=Array.from(a)[0];if(r.has(l))return{changed:!0,removeCandidate:{row:t,col:e,value:l}}}}}let s=Math.floor(t/3)*3,o=Math.floor(e/3)*3;for(let i=s;i<s+3;i++)for(let a=o;a<o+3;a++){if(i===t&&a===e)continue;let l=n.getCandidates(i,a);if(l.size===1){let c=Array.from(l)[0];if(r.has(c))return{changed:!0,removeCandidate:{row:t,col:e,value:c}}}}}return{changed:!1}}};var R=class{constructor(n,t){this.board=n,this.rules=t}step(){for(let n of this.rules){let t=n.apply(this.board);if(t.changed){if("removeCandidate"in t){let{row:e,col:r,value:s}=t.removeCandidate;this.board.removeCandidate(e,r,s)}return t}}return{changed:!1}}};var M=[[0,9,0,0,0,0,0,6,4],[0,0,0,0,0,0,1,0,0],[2,0,0,0,1,4,0,0,5],[0,0,0,9,7,0,0,3,0],[0,0,3,0,6,8,0,0,0],[0,8,0,0,2,0,0,0,0],[7,0,0,0,0,0,0,1,2],[0,4,2,0,0,0,0,0,0],[0,5,0,0,0,3,4,0,0]],B=document.getElementById("sudoku-board");if(B){let o=function(){let a=t.step();if(n.render(),r){let l="";if(a.changed&&"removeCandidate"in a){let{row:f,col:h,value:u}=a.removeCandidate;l=`Removed <b>${u}</b> from <b>R${f+1}C${h+1}</b>`}else l='<span style="color:#888">No further changes found.</span>';let c=document.createElement("li");c.innerHTML=l,r.firstChild?r.insertBefore(c,r.firstChild):r.appendChild(c)}return a},d=new w;for(let a=0;a<9;a++)for(let l=0;l<9;l++){let c=M[a][l];c&&c>0&&(d.setCandidates(a,l,[c]),d.setFrozen(a,l,!0))}let n=new m(B);n.setBoard(d);let t=new R(d,[new k,new F,new x,new z,new y,new v,new A]),e=document.getElementById("step-solver-btn"),r=document.getElementById("solver-log-list"),s;e&&(e.onclick=()=>{o()});let i=document.getElementById("auto-step-toggle");i&&(i.onchange=()=>{i.checked?s=window.setInterval(()=>{let a=o();(!a||!a.changed)&&(i.checked=!1,s&&clearInterval(s))},10):s&&clearInterval(s)}),window.board=d,window.ui=n,window.solver=t}})();
